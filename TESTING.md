## Testing kaf-fleetshard-operator

### Running systemtest

#### Requirements
* kubectl/oc client installed
* connected to a running kubernetes/openshift cluster
* image of operator is built with `quarkus.profile=test` and stored in any container registry
* image of sync is built with `quarkus.profile=test` and stored in any container registry

example how to build and generate deployment files

```bash
mvn package -pl operator -am -DskipTests --no-transfer-progress \
-Dquarkus.container-image.build=true \
-Dquarkus.container-image.push=true \
-Dquarkus.container-image.group=bf2 \
-Dquarkus.container-image.name=kas-fleetshard-operator \
-Dquarkus.container-image.tag=latest \
-Dquarkus.container-image.registry=localhost:5000 \
-Dquarkus.container-image.insecure=true \
-Dkafka=dev \
-Dquarkus.profile=test

mvn package -pl sync -am -DskipTests --no-transfer-progress \
-Dquarkus.container-image.build=true \
-Dquarkus.container-image.push=true \
-Dquarkus.container-image.group=bf2 \
-Dquarkus.container-image.name=kas-fleetshard-sync \
-Dquarkus.container-image.tag=latest \
-Dquarkus.container-image.registry=localhost:5000 \
-Dquarkus.container-image.insecure=true \
-Dquarkus.profile=test
```

### Information
* suite installs latest released strimzi operator
* suite installs CRD generated by kas-fleetshard-api
* suite by default gets generated operator/sync deployments from `target/kubernetes` folders
* if you want to use different deployment files run test suite with env var `YAML_BUNDLE_PATH=/custom/path`

#### Running full suite
```bash
mvn clean verify -P systemtest -pl systemtest -am
```

#### Running smoke tests
```bash
mvn clean verify -P systemtest -pl systemtest -Dgroups=smoke -am
```

#### Running single test or subset of tests
```bash
mvn clean verify -P systemtest -pl systemtest -am -Dit.test=ManagedKafkaST#testDeployManagedKafka
```
```bash
mvn clean verify -P systemtest -pl systemtest -am -Dit.test=ManagedKafkaST,RecoveryST
```

### Running testsuite in parallel
```bash
mvn verify -P systemtest -pl systemtest -am -Djunit.jupiter.execution.parallel.enabled=true
```
```bash
mvn verify -P systemtest -pl systemtest -am \
            -Djunit.jupiter.execution.parallel.enabled=true \
            -Djunit.jupiter.execution.parallel.config.fixed.parallelism=2
```
